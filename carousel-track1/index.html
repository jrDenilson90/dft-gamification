<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Seleção de Tênis</title>
    <!-- <link rel="stylesheet" href="style.css"> -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Bebas+Neue&display=swap');

        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: #ffffff;
            width: calc(100% - 40px);
            max-width: 350px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .close-button {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 28px;
            height: 28px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            border: none;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            line-height: 1;
        }

        .carousel-wrapper {
            width: 100%;
        }

        .carousel-track {
            position: relative;
        }

        .carousel-slide {
            display: none;
            box-sizing: border-box;
            padding: 25px 25px 20px 25px;
            text-align: center;
        }

        .carousel-slide.active {
            display: block;
            animation: slideFadeIn 0.4s ease-in-out;
        }

        .media-container {
            width: 100%;
            aspect-ratio: 16 / 9;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            background-color: #f0f0f0;
        }

        .media-container img,
        .media-container video {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
        }

        .media-container video {
            transform: scale(1.2);
        }

        .slide-content .category {
            font-size: 12px;
            font-weight: 700;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0 0 5px 0;
        }

        .slide-content h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 36px;
            margin: 0 0 10px 0;
            color: #111;
            letter-spacing: 1px;
        }

        .slide-content .description {
            font-size: 15px;
            line-height: 1.6;
            color: #555;
            margin: 0 0 25px 0;
            min-height: 70px;
        }

        .cta-button {
            display: inline-block;
            background-color: #000000;
            color: #ffffff;
            padding: 14px 35px;
            text-decoration: none;
            font-weight: bold;
            border-radius: 8px;
            font-size: 16px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .carousel-nav {
            display: flex;
            justify-content: center;
            padding: 15px 0 25px 0;
        }

        .nav-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #dcdcdc;
            margin: 0 5px;
            transition: background-color 0.3s ease, transform 0.3s ease;
            cursor: pointer;
        }

        .nav-dot.active {
            background-color: #333;
            transform: scale(1.2);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideFadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="modal-overlay">
        <div class="modal-content">
            <button class="close-button" id="closeButton">×</button>

            <div class="carousel-wrapper">
                <div class="carousel-track" id="carouselTrack">

                    <div class="carousel-slide">
                        <div class="media-container">
                            <video autoplay muted loop playsinline src=""></video>
                            <img src="" alt="">
                        </div>
                        <div class="slide-content">
                            <p class="category"></p>
                            <h2 class="title"></h2>
                            <p class="description"></p>
                            <a href="dafiti://br/d/AD464SCF93VGG" class="cta-button"
                                data-tracking-id="cta_superstar_branco"></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="carousel-nav" id="carouselNav">
                <div class="nav-dot" data-slide="0"></div>
            </div>
        </div>
    </div>

    <!-- <script src="script.js"></script> -->
    <script>
        const DADOS_GAMES = {
            textCta: 'Ver detalhes',
            slides: [
                {
                    video: 'https://res.cloudinary.com/dlkvec7ey/video/upload/v1759521111/superstar_vdyhk6.mp4',
                    marca: 'adidas',
                    titulo: 'Superstar II Branco',
                    description: 'O clássico para quem busca estilo autêntico e atitude urbana em todos os passos.',
                    link: 'dafiti://br/d/AD464SCF93VGG',
                    trackingId: 'cta_superstar_branco'
                },
                {
                    img: 'https://braze-images.com/appboy/communication/assets/image_assets/images/68e3a93405a596006390323e/original.jpg?1759750451',
                    marca: 'adidas',
                    titulo: 'Superstar II Preto',
                    description: 'Para quem quer marcar presença: design icônico, preto intenso e personalidade em qualquer ocasião.',
                    link: 'dafiti://br/d/AD464SCU37VTY',
                    trackingId: 'cta_superstar_preto'
                },
                {
                    img: 'https://braze-images.com/appboy/communication/assets/image_assets/images/68e3a9342caadf0063700912/original.jpg?1759750452',
                    marca: 'adidas',
                    titulo: 'Superstar II Preto Estampado',
                    description: 'Versão reimaginada com estampa para quem busca ousadia.',
                    link: 'dafiti://br/d/AD464SCF00NXZ',
                    trackingId: 'cta_superstar_estampado'
                },
                {
                    img: 'https://braze-images.com/appboy/communication/assets/image_assets/images/68e3a934ff238c0065d6021b/original.jpg?1759750452',
                    marca: 'adidas',
                    titulo: 'Superstar II Branco (All White)',
                    description: 'Todo em branco, é a escolha perfeita para quem busca dar um toque de tradição no visual.',
                    link: 'dafiti://br/d/AD464SCU01NXY',
                    trackingId: 'cta_superstar_allwhite'
                },
                {
                    img: 'https://braze-images.com/appboy/communication/assets/image_assets/images/68e3a934a7d96000653ff38b/original.jpg?1759750452',
                    marca: 'adidas',
                    titulo: 'Superstar Slip On Preto',
                    description: 'Versão "Slip On" do Superstar, sem cadarços e com elásticos cruzados. Combinação de praticidade e inovação.',
                    link: 'dafiti://br/d/AD464SCF72QTB',
                    trackingId: 'cta_superstar_slipon'
                }
            ]
        };

        document.addEventListener('DOMContentLoaded', function () {
            // --- Seletores dos Elementos ---
            const track = document.getElementById('carouselTrack');
            const nav = document.getElementById('carouselNav');
            const closeButton = document.getElementById('closeButton');

            // --- Estado do Carrossel ---
            let currentSlide = 0;
            let startX = 0;
            let slides = [];     // array de elementos de slide
            let dots = [];       // array de elementos de nav

            // --- Util ---
            function createElementFromHTML(html) {
                const template = document.createElement('template');
                template.innerHTML = html.trim();
                return template.content.firstChild;
            }
            function escapeHtml(str) {
                if (!str && str !== 0) return '';
                return String(str)
                    .replaceAll('&', '&amp;')
                    .replaceAll('<', '&lt;')
                    .replaceAll('>', '&gt;')
                    .replaceAll('"', '&quot;')
                    .replaceAll("'", '&#39;');
            }

            // Cria slide
            function buildSlide(data, index) {
                const hasVideo = !!data.video;
                const mediaHTML = hasVideo
                    ? `<video muted loop playsinline src="${escapeHtml(data.video)}"></video>`
                    : `<img loading="lazy" src="${escapeHtml(data.img)}" alt="${escapeHtml(data.titulo || '')}">`;

                const slideHTML = `
            <div class="carousel-slide" data-index="${index}">
                <div class="media-container">${mediaHTML}</div>
                <div class="slide-content">
                    <p class="category">${escapeHtml(data.marca || '')}</p>
                    <h2 class="title">${escapeHtml(data.titulo || '')}</h2>
                    <p class="description">${escapeHtml(data.description || '')}</p>
                    <a href="${escapeHtml(data.link || '#')}" class="cta-button" data-tracking-id="${escapeHtml(data.trackingId || '')}">${escapeHtml(DADOS_GAMES.textCta)}</a>
                </div>
            </div>
        `;
                return createElementFromHTML(slideHTML);
            }

            // Cria dot
            function buildDot(i) {
                const dot = document.createElement('div');
                dot.className = 'nav-dot';
                dot.setAttribute('data-slide', String(i));
                dot.setAttribute('role', 'button');
                dot.setAttribute('aria-label', `Ir para slide ${i + 1}`);
                dot.tabIndex = 0;
                dot.addEventListener('click', () => showSlide(i));
                dot.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') showSlide(i); });
                return dot;
            }

            // --- Renderização ---
            function renderCarousel() {
                track.innerHTML = '';
                nav.innerHTML = '';
                slides = [];
                dots = [];

                DADOS_GAMES.slides.forEach((item, idx) => {
                    const slideEl = buildSlide(item, idx);
                    track.appendChild(slideEl);
                    slides.push(slideEl);

                    const dot = buildDot(idx);
                    nav.appendChild(dot);
                    dots.push(dot);
                });

                // marca primeiro como ativo
                if (slides.length) {
                    slides[0].classList.add('active');
                    dots[0].classList.add('active');
                }

                attachCTAListeners();
                ensureVideoAutoplayForCurrent();
            }

            // --- Navegação ---
            function showSlide(index) {
                if (index < 0) index = 0;
                if (index >= slides.length) index = slides.length - 1;
                slides.forEach(s => s.classList.remove('active'));
                dots.forEach(d => d.classList.remove('active'));

                const slide = slides[index];
                if (!slide) return;
                slide.classList.add('active');
                dots[index].classList.add('active');
                currentSlide = index;
                handleVideoPlayback(index);
            }

            function handleVideoPlayback(activeIndex) {
                slides.forEach((s, i) => {
                    const videoEl = s.querySelector('video');
                    if (videoEl) {
                        if (i === activeIndex) {
                            videoEl.muted = true;
                            const p = videoEl.play();
                            if (p !== undefined) p.catch(() => { /* autoplay bloqueado */ });
                        } else {
                            try { videoEl.pause(); videoEl.currentTime = 0; } catch (e) { /* ignore */ }
                        }
                    }
                });
            }

            function ensureVideoAutoplayForCurrent() {
                const activeVideo = track.querySelector('.carousel-slide.active video') || track.querySelector('video');
                if (activeVideo) {
                    activeVideo.muted = true;
                    const p = activeVideo.play();
                    if (p !== undefined) p.catch(err => console.log('Autoplay do vídeo bloqueado pelo navegador.', err));
                }
            }

            // --- Swipe (touch) ---
            track.addEventListener('touchstart', (e) => { startX = e.touches[[0]]().clientX; }, { passive: true });
            track.addEventListener('touchend', (e) => {
                const endX = e.changedTouches[[0]]().clientX;
                const diffX = startX - endX;
                if (Math.abs(diffX) > 50) {
                    if (diffX > 0) { showSlide(currentSlide + 1); }
                    else { showSlide(currentSlide - 1); }
                }
            });

            // --- Mouse drag (desktop) ---
            let isDown = false, startDragX = 0;
            track.addEventListener('mousedown', e => { isDown = true; startDragX = e.clientX; track.classList.add('dragging'); });
            document.addEventListener('mouseup', e => {
                if (!isDown) return;
                isDown = false;
                track.classList.remove('dragging');
                const diff = startDragX - e.clientX;
                if (Math.abs(diff) > 50) {
                    if (diff > 0) showSlide(currentSlide + 1);
                    else showSlide(currentSlide - 1);
                }
            });

            // --- Tracking e CTA listeners ---
            function attachCTAListeners() {
                const ctas = track.querySelectorAll('.cta-button');
                ctas.forEach(btn => {
                    btn.addEventListener('click', (ev) => {
                        const trackingId = btn.getAttribute('data-tracking-id');
                        if (trackingId) {
                            try {
                                if (window.brazeBridge && typeof brazeBridge.logClick === 'function') {
                                    brazeBridge.logClick(trackingId);
                                }
                            } catch (e) {
                                console.error('Braze Bridge não disponível.', e);
                            }
                        }
                        // não previne o comportamento do link (deeplink dafiti://)
                    });
                });
            }

            // --- Botão de fechar ---
            closeButton.addEventListener('click', () => {
                try {
                    if (window.brazeBridge && typeof brazeBridge.logClick === 'function') {
                        brazeBridge.logClick('close_button_clicked');
                        brazeBridge.closeMessage && brazeBridge.closeMessage();
                    }
                } catch (e) {
                    console.error('Braze Bridge não disponível.', e);
                }
                const overlay = document.querySelector('.modal-overlay');
                if (overlay) overlay.remove();
            });

            // --- Inicialização ---
            renderCarousel();

            // Exibe primeiro slide (caso renderCarousel não tenha marcado)
            if (slides.length) showSlide(0);

            // Teclado
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight') showSlide(currentSlide + 1);
                if (e.key === 'ArrowLeft') showSlide(currentSlide - 1);
                if (e.key === 'Escape') closeButton.click();
            });

            // debug
            window._carousel = { showSlide, getCurrent: () => currentSlide, slides };
        });
    </script>
</body>

</html>